# Configuration script for Travis CI.
# Instructions to install the MPI implementation
# were taken from https://github.com/bsamseth/mpi4py-travis/

language: python
python:
  - "3.7"

dist: xenial

cache:
  directories:
    - $TRAVIS_BUILD_DIR/openmpi-build
    - $TRAVIS_BUILD_DIR/openmpi-3.1.3

matrix:
  include:
    - os: linux
      addons:
        apt:
          sources:
            - deadsnakes
            - ubuntu-toolchain-r-test
          packages:
            - g++-7
            - gfortran-7
      env:
        - C_COMPILER="gcc-7", CXX_COMPILER="g++-7", FORTRAN_COMPILER="gfortran-7"

before_install:
  - python -m pip --version
  - python -m pip install --upgrade pip
  - python -m pip --version
  - python -m pip install build
  - export MPI_BUILD_DIR=$TRAVIS_BUILD_DIR/openmpi-build
  - export MPI_VERSION="4.0"
  - export MPI_FULL_VERSION="4.0.5"
install:
  - python -c "import sysconfig;print(sysconfig.get_config_var('LDSHARED'))"
  - python -m pip install obspy
  - source ci/install-openmpi.sh
  - echo $MPI_FC
  - echo $MPI_EXEC
  - env MPICC=$MPI_CC python -m pip install mpi4py
  - env MPICC=$MPI_CC python -m pip install .

script:
  - pytest
